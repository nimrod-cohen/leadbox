window.lpManager={id_gen:null,options:null,resizeCallbacks:[],disposable_email_domains:null,required_passes:{email:4,text:1,phone:2,submit:1},init:function(i){this.id_gen=Date.now(),this.options=i,this.options.forms={},this.doLanguageOverrides(),this.loadFonts(),this.options.enable_disposables_check&&this.loadDisposableEmailDomains();for(var t=0;t<this.resizeCallbacks.length;t++)jQuery(window).off("resize",this.resizeCallbacks[t]);this.resizeCallbacks.length=0;var e=this;jQuery("div[leadbox-form]").each(function(){var i=jQuery(this);i.attr("id")&&0!=i.attr("id").length||i.attr("id","frm_"+e.id_gen++),hostId=i.attr("id"),e.options.forms[hostId]=[];var t=e.options.forms[hostId];e.enhanceFields(t,hostId),e.render(i,t),i.find("button.lp-object").click(e.saveDetails),e.resizeObjects(i,t);var o=function(){e.resizeObjects(i,t)};e.resizeCallbacks.push(o),jQuery(window).resize(o)})},loadFonts:function(){for(var i=this.options.google_fonts.split(","),t=0;t<i.length;t++)i[t]=i[t].replace(/^\s*'?(.*?)'?\s*$/g,"$1");WebFontConfig={google:{families:i}};var e=document.createElement("script");e.src=("https:"==document.location.protocol?"https":"http")+"://ajax.googleapis.com/ajax/libs/webfont/1/webfont.js",e.type="text/javascript",e.async="true";var o=document.getElementsByTagName("script")[0];o.parentNode.insertBefore(e,o)},doLanguageOverrides:function(){for(var i in this.options.languageOverrides)this.langTable[this.options.language][i]=this.options.languageOverrides[i]},lang:function(i){return this.langTable[this.options.language][i]},enhanceFields:function(i,t){i.push({passes:0,status:"not_ready",id:t+"_submit_button",type:"submit"});for(var e=0;e<this.options.fields.length;e++){var o=this.options.fields[e],s=jQuery.extend(!0,{id:t+"_fld_"+this.id_gen++,passes:0,status:"not_ready"},o);i.push(s),"hidden"==s.type&&(s.status="ready")}},findField:function(i){for(var t=this.getHostId(i),e=this.options.forms[t],o=0;o<e.length;o++)if(i==e[o].id)return e[o];return null},resetField:function(i){var t=this.findField(i),e=this.getHostId(i);t.passes=0,t.status="not_ready",t.id!=e+"_submit_button"&&"hidden"!=t.type&&(this.clearNotification(t.id),this.resetField(e+"_submit_button"))},clearNotification:function(i){jQuery("#"+i).siblings(".lp-suggest").remove(),jQuery("#"+i).removeClass("lp-error lp-pass lp-suggest")},getHostId:function(i){return jQuery("#"+i).closest("div[leadbox-form]").attr("id")},fieldPass:function(i){var t=this.findField(i),e=this.getHostId(i);"failed"!=t.status&&(t.passes++,t.passes<this.required_passes[t.type]||(t.status="ready",t.id!=e+"_submit_button"&&this.showFieldPass(i),this.doSubmit(e)))},showFieldPass:function(i){this.clearNotification(i);var t=jQuery("#"+i);t.val().trim().length>0&&t.after(t,"<span class='lp-suggest lp-pass'>"+this.lang("looks_good")+"</span>")},showFieldSuggestion:function(i,t){this.clearNotification(i);var e=jQuery("#"+i);jQuery(e).after(e,"<span class='lp-suggest'>"+t+"</span>")},showFieldError:function(i,t){this.clearNotification(i);var e=jQuery("#"+i);e.addClass("lp-error"),t&&e.after(e,"<span class='lp-suggest lp-error'>"+this.lang(t)+"</span>")},render:function(i,t){var e=i.attr("id"),o="<form class='lp-container "+this.options.layout+"' style='direction:"+this.options.direction+"'>";this.langTable[this.options.language].tag_line.length>0&&(o+="<h3 class='lp-title'>"+$("<div/>").html(this.langTable[this.options.language].tag_line).text()+"</h3>"),o+="<div class='thanku-pop'>"+this.options.thanku_html+"</div>";for(var s=0;s<t.length;s++){var n=t[s];if(n.id!=e+"_submit_button")switch(n.type){case"hidden":o+="<input type='hidden' id='"+n.id+"' name='"+n.name+"' value='"+n.value+"'>";continue;case"multiline":o+="<div class='lp-row multiline'><label for='"+n.id+"' class='lp-label'>"+n.label+"</label><textarea id='"+n.id+"' class='lp-object lp-input "+(n.required?"required":"")+"' name='"+n.name+"' lp-validate='"+n.type+"' placeholder='"+n.label+"'></textarea></div>";break;case"checkbox":o+="<div class='lp-row'><input id='"+n.id+"' type='checkbox' "+(n.value.length>0?"checked":"")+" class='lp-object lp-input "+(n.required?"required":"")+"' name='"+n.name+"' lp-validate='"+n.type+"' />&nbsp;"+n.label+"</div>";break;default:o+="<div class='lp-row'><label for='"+n.id+"' class='lp-label'>"+n.label+"</label><input id='"+n.id+"' type='"+n.type+"' class='lp-object lp-input "+(n.required?"required":"")+"' name='"+n.name+"' lp-validate='"+n.type+"' placeholder='"+n.label+"' /></div>"}}o+="<div class='lp-row'><button id='"+e+"_submit_button' class='lp-object'>"+this.lang("save")+"</button></div></form>",i.append("<style>\nform.lp-container { border-radius:"+this.options.border_radius+"px; padding:4px; position:relative; background-color: "+this.options.background+";font-family:"+this.options.google_fonts+", 'Sans Serif';}\nform.lp-container h3.lp-title {padding: 10px;margin:0;text-align: center;color:"+this.options.color+"} form.lp-container * { font-family:"+this.options.google_fonts+", 'Sans Serif';}\ndiv.thanku-pop { width: 100%; height: 100%; position: absolute; top: 0; left: 0; background-color: "+this.options.background+"; display: none; z-index: 100;}\n.lp-row { color:"+this.options.color+";position:relative; margin:8px 10px; padding-bottom:12px; display: "+("horizontal"==this.options.layout?"inline-":"")+"block; }\n.lp-row.multiline { padding-bottom:0; }\nform.horizontal .lp-row { vertical-align:top; margin:0 6px; min-width:140px;}\nform.horizontal button.lp-object { margin-top:"+(this.options.show_labels?"16":"0")+"px;}\n.lp-object { box-sizing: border-box; font-size:18px; line-height:24px; padding:4px; margin:0; border:solid 0px gray; color:"+this.options.input.text_color+";background-color:"+this.options.input.background+"; border-radius:"+this.options.border_radius+"px;outline:0;}\n.lp-label { font-size:12px; line-height:16px; margin:0; display:"+(this.options.show_labels?"block":"none")+"; }\n.lp-suggest { position: absolute; bottom:0px; font-size:12px; line-height:12px; color:orange;"+("rtl"==this.options.direction?"right":"left")+":0px; }.lp-suggest.lp-pass { color: green; }.lp-suggest.lp-error { color: #AF0000; }textarea.lp-input { resize:none; line-height:18px; height:54px; margin-bottom:8px; font-size:14px; }.lp-input.lp-error { background-color:#FFECEF; background-repeat:no-repeat;background-position:"+("rtl"==this.options.direction?"1":"98")+".5% center;}\n"+("rtl"==this.options.direction?".lp-input.lp-error { background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAABmJLR0QA/wD/AP+gvaeTAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH3wcGFTMSpcjydQAAAB1pVFh0Q29tbWVudAAAAAAAQ3JlYXRlZCB3aXRoIEdJTVBkLmUHAAAAcUlEQVQ4y+3SywmFQBBE0TuDOZhVmYQrk3gahmAUlZIro9CNPMSVMA0qWMumOdCfJKkBRqCmLAvQ5iCM3ZhyEPZH85Uu28l2utKbCc4HlidJWt8/8q1/+PgdzpHgDHTVqdjbHqJGLsaOYAgGgKRf5FU2OS0d+SsoTpYAAAAASUVORK5CYII=');}\n":".lp-input.lp-error { background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAABmJLR0QA/wD/AP+gvaeTAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH3wcHCxsmdyVBdQAAAB1pVFh0Q29tbWVudAAAAAAAQ3JlYXRlZCB3aXRoIEdJTVBkLmUHAAAAf0lEQVQ4y2P08/PzYWBgmMPAwCDOQBl4ycDAkM5EJcMYoGbMZKKSYXBDmYhRtWnTJsZNmzYxEqOWiYHKYNRAygGjn5/f/6Hv5QFNhzQJw8fUNjCLmoYyUmqAn59fPQMDQwOMz0ypgTdv3jyorq7OwMDA4EAVA9ENZaZW2MEMBQBZ4SD8U6/0DAAAAABJRU5ErkJggg==');}\n")+"button.lp-object { margin-top:10px;cursor:pointer; color:"+this.options.submit.text_color+";background-color:"+this.options.submit.background+";}\nbutton.lp-object:active { background-color:"+this.colorLuminance(this.options.submit.background,-.05)+";}\nbutton.lp-object.waiting { background-color:"+this.colorLuminance(this.options.submit.background,-.2)+";}\n</style>"),i.append(o);var a=this;i.find(".lp-input").focus(function(){a.resetField(this.id)}),i.find(".lp-input").blur(function(){a.doValidations(this.id)}),i.find(".lp-input").change(function(){a.resetField(this.id)})},switchSubmitDirection:function(i,t){var e=jQuery("#"+t[t.length-1].id),o=jQuery("#"+t[0].id);if(e.length&&o.length){{var s=o.closest(".lp-row");i.offset().left}s.css("left",""),e.offset().top!=o.offset().top&&s.css("left",e.offset().left-o.offset().left)}},resizeObjects:function(i,t){var e=i.width()-20,o=Math.min(this.options.input.max_width,e),o=Math.max(100,o),s=Math.min(250,o);s=Math.max(100,s),jQuery("#"+i.attr("id")+" .lp-input:not([type='checkbox'])").width(o),jQuery("#"+i.attr("id")+" .lp-container button").width(s);this.options.submit.oppositeDirection&&"vertical"!=this.options.layout&&this.switchSubmitDirection(i,t)},loadDisposableEmailDomains:function(){var i=this;jQuery.getJSON("https://raw.githubusercontent.com/ivolo/disposable-email-domains/master/index.json",function(t){i.disposable_email_domains=t}).error(function(){})},doValidations:function(i){field=lpManager.findField(i),lpManager.resetField(i);var t=jQuery("#"+i),e=t.val().trim();if(field.required){if(0==e.length||"checkbox"==field.type&&!t.is(":checked"))return field.status="failed",void lpManager.showFieldError(i,"mandatory_field");lpManager.fieldPass(field.id)}else lpManager.fieldPass(field.id);switch(field.type){case"email":lpManager.doEmailValidations(field,e);break;case"phone":lpManager.doPhoneValidations(field,e)}},doPhoneValidations:function(i,t){var e=/^\+?[\d\. \-\(\)]{7,}$/g,o=t.replace(/\D/g,"");return t.length>0&&(!e.test(t)||o.length<7||o.length>12)?(lpManager.showFieldError(i.id,"wrong_phone_format"),void(i.status="failed")):void lpManager.fieldPass(i.id)},doEmailValidations:function(i,t){var e=/^([\w\.\-_]+)?\w+@[\w-_]+(\.\w+){1,}$/gi;if(t.length>0&&!e.test(t))return i.status="failed",void this.showFieldError(i.id,"invalid_email_address");this.fieldPass(i.id);var o=t.substr(t.indexOf("@")+1).trim();if(t.length>0&&this.options.enable_disposables_check&&this.disposable_email_domains&&this.disposable_email_domains.indexOf(o)>=0)return i.status="failed",void this.showFieldError(i.id,"invalid_email_address");this.fieldPass(i.id);var s=this;t.length>0&&window.run_validator&&this.options.enable_validator?run_validator(t,{api_key:s.options.mailgun_key,success:function(t){t.is_valid?(s.fieldPass(i.id),t.did_you_mean&&s.showFieldSuggestion(i.id,s.lang("did_you_mean")+" <b>"+t.did_you_mean+"</b>")):(s.showFieldError(i.id,"invalid_email_address"),i.status="failed")},error:function(){s.fieldPass(i.id)}}):this.fieldPass(i.id),!this.options.enable_validator&&this.options.enable_suggestions&&window.Mailcheck&&jQuery("#"+i.id).mailcheck({suggested:function(i,t){s.showFieldSuggestion(i[0].id,s.lang("did_you_mean")+" "+t.address+"<b>@"+t.domain+"</b>")},empty:function(){}})},saveDetails:function(i){if(i.preventDefault(),lpManager.isSaving())return!1;lpManager.showSaving();for(var t=lpManager.getHostId(jQuery(i.target).attr("id")),e=lpManager.options.forms[t],o=0;o<e.length;o++){var s=e[o];"not_ready"==s.status&&s.id!=t+"_submit_button"&&"hidden"!=s.type&&lpManager.doValidations(s.id)}return lpManager.fieldPass(t+"_submit_button"),!1},doSubmit:function(i){for(var t=this.options.forms[i],e=0;e<t.length;e++)if("ready"!=t[e].status)return void lpManager.releaseSaving();for(var o={},e=0;e<t.length;e++){var s=t[e];s.id!=i+"_submit_button"&&(o[s.name]="checkbox"==s.type?jQuery("#"+s.id).is(":checked"):jQuery("#"+s.id).val())}lpManager.options.callback(o);for(var e=0;e<t.length;e++)"hidden"!=t[e].type&&(t[e].status="not_ready");lpManager.releaseSaving(),console.log("form submitted successfully")},isSaving:function(){return jQuery("button.lp-object").hasClass("waiting")},showSaving:function(){jQuery("button.lp-object").addClass("waiting")},releaseSaving:function(){jQuery("button.lp-object").removeClass("waiting")},colorLuminance:function(i,t){i=String(i).replace(/[^0-9a-f]/gi,""),i.length<6&&(i=i[0]+i[0]+i[1]+i[1]+i[2]+i[2]),t=t||0;var e,o,s="#";for(o=0;3>o;o++)e=parseInt(i.substr(2*o,2),16),e=Math.round(Math.min(Math.max(0,e+e*t),255)).toString(16),s+=("00"+e).substr(e.length);return s},langTable:{english:{did_you_mean:"Did you mean",invalid_email_address:"Invalid email address",wrong_phone_format:"Wrong phone format",looks_good:"Looks good",mandatory_field:"This field is required",save:"save"},hebrew:{did_you_mean:"האם התכוונת ל",invalid_email_address:"כתובת המייל אינה תקינה",wrong_phone_format:"מספר טלפון בפורמט שגוי",looks_good:"תקין",mandatory_field:"זהו שדה חובה",save:"שמור"}}};